{"version":3,"file":"0.js","sources":["webpack:///./node_modules/@babel/runtime-corejs2/core-js/json/stringify.js","webpack:///./node_modules/@babel/runtime-corejs2/core-js/object/values.js","webpack:///./node_modules/@babel/runtime-corejs2/core-js/promise.js","webpack:///./src/api/index.ts","webpack:///./src/components/Loader/index.tsx","webpack:///./src/components/Loader/styles.module.scss","webpack:///./src/containers/WorldMap/CountryInfoModal.tsx","webpack:///./src/containers/WorldMap/index.tsx","webpack:///./src/containers/WorldMap/styles.module.scss"],"sourcesContent":["module.exports = require(\"core-js/library/fn/json/stringify\");","module.exports = require(\"core-js/library/fn/object/values\");","module.exports = require(\"core-js/library/fn/promise\");","import { ITimeLineResponse, ICountry, ICountryStatistic, IDateStatistic, IVirtualizationResponse, IFeature } from '../models';\n\nexport const apiUrl = 'https://cors-anywhere.herokuapp.com/https://api.the2019ncov.com/api/';\nexport const codevizApi = 'https://cors-anywhere.herokuapp.com/https://www.covidvisualizer.com/api';\n\nexport const getAllCases = (): Promise<IDateStatistic> => {\n  return new Promise<IDateStatistic>(async (resolve, reject) => {\n    const link = `${apiUrl}/cases`;\n    fetch(link)\n      .then((res) => res.json())\n      .catch((err) => reject({ code: 401, message: err.message }))\n      .then((res) => resolve(res));\n  });\n};\n\nexport const getTimeLineNews = (): Promise<ITimeLineResponse[]> => {\n  return new Promise<ITimeLineResponse[]>((resolve, reject) => {\n    const link = `${apiUrl}/timeline`;\n    fetch(link)\n      .then((res) => res.json())\n      .catch((err) => reject({ code: 401, message: err.message }))\n      .then((res) => resolve(res));\n  });\n};\n\nexport const getCountry = (): Promise<ICountry> => {\n  return new Promise<ICountry>((resolve, reject) => {\n    fetch('http://ip-api.com/json')\n      .then((res) => res.json())\n      .catch((err) => reject({ code: 401, message: err.message }))\n      .then((res) => resolve({ status: res.status, country: res.country }));\n  });\n};\n\nexport const getDataForMap = (): Promise<IVirtualizationResponse> => {\n  return new Promise<IVirtualizationResponse>((resolve, reject) => {\n    fetch(codevizApi)\n      .then((res) => res.json())\n      .catch((err) => reject({ code: 401, message: err.message }))\n      .then((res) => resolve(res));\n  });\n};\n\nexport const getD3Data = (): Promise<IFeature[]> => {\n  return new Promise<IFeature[]>((resolve, reject) => {\n    fetch('https://vasturiano.github.io/globe.gl/example/datasets/ne_110m_admin_0_countries.geojson')\n      .then((res) => res.json())\n      .then((res) => resolve(res.features))\n      .catch((err) => reject({ code: 401, message: err.message }));\n  });\n};\n","import React from 'react';\nimport styles from './styles.module.scss';\nimport { Spinner } from 'reactstrap';\n\nconst Loader = () => {\n  return (\n    <div className={styles.loaderWrapper}>\n      <Spinner style={{ width: '3rem', height: '3rem' }} />\n    </div>\n  );\n};\n\nexport default Loader;\n","module.exports = {\n\t\"loaderWrapper\": \"loaderWrapper___YQPKA\"\n};","import React, { useState, useContext, useEffect } from 'react';\nimport { ICountryStatistic, ICountryJSON, IVizualiztionCountry } from '../../models';\nimport styles from './styles.module.scss';\n\nexport interface ICountryInfoModal {\n  coutryStatistic: IVizualiztionCountry;\n  isOpen: boolean;\n}\n\nconst CountryInfoModal: React.FC<ICountryInfoModal> = (props) => {\n  const { coutryStatistic, isOpen } = props;\n  if (!isOpen) {\n    return <></>;\n  }\n  return (\n    <div className={styles.infoModal} style={{ position: 'fixed', top: 0, left: 0 }}>\n      <img src={coutryStatistic.flag} />\n      <div className={styles.titleContainer}>\n        <span>\n          <em>{coutryStatistic.name}</em>\n        </span>\n        <span>{coutryStatistic.cases} total cases</span>\n      </div>\n      <div className={styles.detailedInfo}>\n        <span>{coutryStatistic.reports} active</span>\n        <span>{coutryStatistic.deaths} deadths</span>\n        <span>{coutryStatistic.recovered} recovered</span>\n      </div>\n    </div>\n  );\n};\n\nexport default React.memo(CountryInfoModal);\n","import React, { useState, useRef, useEffect, useMemo, useCallback } from 'react';\nimport styles from './styles.module.scss';\nimport { getDataForMap, getD3Data } from '../../api';\nimport Loader from '../../components/Loader';\nimport { IVirtualizationResponse, IError, IFeature } from '../../models';\nimport Globe from 'react-globe.gl';\nimport * as d3 from 'd3';\nimport CountryInfoModal from './CountryInfoModal';\n\nconst WorldMap: React.FC = () => {\n  const globeEl = useRef(null);\n  const [isLoaded, handleLoaded] = useState<boolean>(false);\n  const [data, handleData] = useState<IVirtualizationResponse>();\n  const [error, handleError] = useState<IError | undefined>(undefined);\n  const [countries, setCountries] = useState<IFeature[]>();\n  const [hoverD, setHoverD] = useState();\n  const [isModalOpen, setModalState] = useState<boolean>(false);\n  const [selectedCountry, setSelectedCountry] = useState<IFeature>();\n\n  const fetchData = async () => {\n    try {\n      const featureData = await getD3Data();\n      setCountries(featureData);\n    } catch (e) {\n      handleError(e);\n    }\n  };\n\n  const fetchDataForMap = async () => {\n    try {\n      const data = await getDataForMap();\n      handleData(data);\n    } catch (e) {\n      handleError(e);\n    }\n  };\n\n  const handleGlobeClick = (): void => {\n    if (hoverD) {\n      setSelectedCountry(hoverD);\n      setModalState(true);\n    } else {\n      setModalState(false);\n      setSelectedCountry(undefined);\n    }\n  };\n\n  useEffect(() => {\n    fetchData();\n    fetchDataForMap();\n  }, []);\n\n  useEffect(() => {\n    // aim at continental Ukraine centroid\n    if (globeEl.current) {\n      globeEl.current.pointOfView({ lat: 49, lng: 32, altitude: 0.8 });\n    }\n  }, [JSON.stringify(globeEl.current)]);\n\n  const scaleSequentialSqrt = d3['scaleSequentialSqrt'];\n\n  useEffect(() => {\n    if (data && countries) {\n      countries.forEach((country: IFeature) => {\n        const dataCountriesValues = Object.values(data.countries);\n        for (let i = 0; i < dataCountriesValues.length; i++) {\n          if (\n            dataCountriesValues[i].name === country.properties.NAME_LONG ||\n            dataCountriesValues[i].name === country.properties.SOVEREIGNT ||\n            dataCountriesValues[i].name === country.properties.FORMAL_EN\n          ) {\n            return (country.statistic = dataCountriesValues[i]);\n          }\n        }\n      });\n    }\n  }, [data, countries]);\n\n  useEffect(() => {\n    if (countries) {\n      handleLoaded(true);\n    }\n  }, [countries]);\n\n  const maxCases = 2000000;\n\n  const colorScale = scaleSequentialSqrt(d3.interpolateYlOrRd);\n\n  const getVal = (feat: any) => {\n    if (feat.statistic) {\n      return feat.statistic.cases / Math.max(1e5, maxCases);\n    } else {\n      return feat.properties.GDP_MD_EST / Math.max(1e5, feat.properties.POP_EST);\n    }\n  };\n\n  const maxVal = useMemo(() => countries && Math.max(...countries.map(getVal)), [countries]);\n\n  colorScale.domain([0, maxVal]);\n\n  const getLabelString = (properties: any): string => {\n    if (!hoverD) {\n      setHoverD(properties);\n    }\n    if (properties.statistic)\n      return `<div> ${properties.statistic.name}</div>\n    `;\n    else\n      return `\n      <div>${properties.properties.NAME_SORT}</div>\n    `;\n  };\n\n  const onPolygonClick = useCallback(\n    (feature: any) => {\n      setModalState(true);\n      if (feature) {\n        setSelectedCountry(feature);\n      } else {\n        setSelectedCountry(undefined);\n        setModalState(false);\n      }\n    },\n    [selectedCountry]\n  );\n\n  if (error) {\n    return <div>Something went wrong </div>;\n  }\n  if (!isLoaded) {\n    return <Loader />;\n  }\n\n  const isMobile = window.innerWidth < 700;\n\n  return (\n    <div ref={globeEl} onClick={handleGlobeClick} className={styles.worldMapContainer}>\n      <Globe\n        //@ts-ignore\n        ref={globeEl}\n        globeImageUrl=\"//unpkg.com/three-globe/example/img/earth-dark.jpg\"\n        backgroundImageUrl=\"//unpkg.com/three-globe/example/img/night-sky.png\"\n        polygonsData={countries}\n        polygonAltitude={(d) => (d === hoverD ? 0.12 : 0.06)}\n        polygonCapColor={(d) => (d === hoverD ? 'steelblue' : colorScale(getVal(d)))}\n        polygonStrokeColor={() => '#111'}\n        polygonLabel={!isMobile ? (item) => getLabelString(item) : ''}\n        onPolygonHover={setHoverD}\n        onPolygonClick={(r) => onPolygonClick(r)}\n        polygonsTransitionDuration={300}\n      />\n      {selectedCountry && selectedCountry.statistic && (\n        <CountryInfoModal isOpen={isModalOpen} coutryStatistic={selectedCountry.statistic} />\n      )}\n    </div>\n  );\n};\n\nexport default WorldMap;\n","module.exports = {\n\t\"worldMapContainer\": \"worldMapContainer___6XYFA\",\n\t\"infoModal\": \"infoModal___2-IPc\",\n\t\"titleContainer\": \"titleContainer___2EldA\",\n\t\"detailedInfo\": \"detailedInfo___1hjeN\"\n};"],"mappings":";;;;;;;;;;AAAA;;;;;;;;;;;ACAA;;;;;;;;;;;ACAA;;;;;;;;;;;;;;;;;;;;;;;ACEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AACA;AAEA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAEA;AAAA;AAAA;AAEA;AACA;AAEA;AACA;AACA;AAGA;AAAA;AAAA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;AClDA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAGA;AACA;AACA;;;;;;;;;;;ACZA;AACA;AACA;;;;;;;;;;;;;;;;;;;ACFA;AAEA;AACA;AAMA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AACA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAEA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AChCA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AAAA;AACA;AAKA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAEA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAIA;AADA;AAGA;AACA;AACA;AAEA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAGA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAZA;AAAA;AAAA;AAAA;AAAA;AAAA;AAeA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;AACA;AACA;;;;;;;;;;;AC9JA;AACA;AACA;AACA;AACA;AACA;;;;A","sourceRoot":""}